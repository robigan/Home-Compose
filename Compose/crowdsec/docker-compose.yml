version: "3.9"

services:
  crowdsec:
    image: crowdsecurity/crowdsec:latest
    restart: unless-stopped
    environment:
      TZ: ${TZ:-Europe/Rome}
      ENROLL_KEY: ${ENROLL_KEY:?UNSET_ENROLL_KEY_ERROR}
      ENROLL_INSTANCE_NAME: ${INSTANCE_NAME:?UNSET_INSTANCE_NAME_ERROR}
      COLLECTIONS: "crowdsecurity/linux crowdsecurity/traefik crowdsecurity/http-cve"
    ports:
      - 8080:8080
    networks:
      - default
      - proxy
    volumes:
      - db:/var/lib/crowdsec/data/
    configs:
      - source: crowdsec-config
        target: /etc/crowdsec/config.yaml.local

networks:
  proxy:
    external: true
    name: proxy

volumes:
  db:
    name: crowdsec-db

configs:
  crowdsec-config:
    content: |
      # Crowdsec configuration file
      # See https://doc.crowdsec.net/docs/usage/configuration
      # for more information on the configuration file
      # and its options.
      # This file is generated by the ansible playbook.
      # Do not edit this file manually.
      # It will be overwritten by the ansible playbook.
      # See
      prometheus:
        enabled: false